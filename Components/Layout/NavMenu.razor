@using Pennywise.Services.Interfaces
@using Pennywise.Model
@inject NavigationManager NavigationManager
@inject IUserService UserService

<div class="sidebar">
    <div class="logo-container">
        <img src="/images/logo.png" alt="PennyWise" class="nav-logo" />
    </div>
    
    <nav class="nav-menu">
        <a href="/home" class="nav-item @(GetActiveClass("/home"))">
            <img src="/images/icons/dashboard.png" class="nav-icon" alt="dashboard" />
            <span>Dashboard</span>
        </a>
        <a href="/transactions" class="nav-item @(GetActiveClass("/transactions"))">
            <img src="/images/icons/transactions.png" class="nav-icon" alt="transactions" />
            <span>Transactions</span>
        </a>
        
        <a href="/debts" class="nav-item @(GetActiveClass("/debts"))">
            <img src="/images/icons/debt.png" class="nav-icon" alt="debt" />
            <span>Debt</span>
        </a>
    </nav>
    
    <div class="logout-container">
        <button @onclick="ShowLogoutConfirmation" class="nav-item logout-button">
            <img src="/images/icons/logout.png" class="nav-icon" alt="logout" />
            <span>Logout</span>
        </button>
    </div>
</div>

@if (showLogoutDialog)
{
    <div class="modal-backdrop" @onclick="HideLogoutConfirmation">
        <div class="modal-dialog" @onclick:stopPropagation="true">
            <div class="modal-content">
                <div class="modal-header">
                    <h5>Confirm Logout</h5>
                    <button class="close-button" @onclick="HideLogoutConfirmation">&times;</button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to logout?</p>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" @onclick="HideLogoutConfirmation">No</button>
                    <button class="btn-primary" @onclick="Logout">Yes</button>
                </div>
            </div>
        </div>
    </div>
}

@code {
    private bool showLogoutDialog = false;

    private string GetActiveClass(string href)
    {
        var currentUrl = NavigationManager.Uri;
        var baseUri = NavigationManager.BaseUri;
        var relativePath = currentUrl.Substring(baseUri.Length).TrimEnd('/');
        
        return relativePath.Equals(href.TrimEnd('/'), StringComparison.OrdinalIgnoreCase) ? "active" : "";
    }

    private void ShowLogoutConfirmation()
    {
        showLogoutDialog = true;
    }

    private void HideLogoutConfirmation()
    {
        showLogoutDialog = false;
    }

    private void Logout()
    {
        UserService.Logout();
        showLogoutDialog = false;
        NavigationManager.NavigateTo("/login");
    }
}